[{"C:\\Users\\pshbl\\IdeaProjects\\crypto-el-gamal\\front\\crypro-app\\src\\App.js":"1","C:\\Users\\pshbl\\IdeaProjects\\crypto-el-gamal\\front\\crypro-app\\src\\index.js":"2"},{"size":13356,"mtime":1639948321659,"results":"3","hashOfConfig":"4"},{"size":274,"mtime":1616081641000,"results":"5","hashOfConfig":"4"},{"filePath":"6","messages":"7","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"8"},"1jiwqng",{"filePath":"9","messages":"10","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"C:\\Users\\pshbl\\IdeaProjects\\crypto-el-gamal\\front\\crypro-app\\src\\App.js",["11","12","13","14"],"import {Button, Col, Container, Form, Row, Tab, Tabs} from \"react-bootstrap\";\nimport React, {useState, useRef} from 'react';\nimport SockJsClient from 'react-stomp';\nimport axios from \"axios\";\nimport bigInt from \"big-integer\";\n\nconst usernames = ['Maxim1', 'Maxim2'];\n\n\nfunction generateNewKey() {\n    const p = generateRandomPrime();\n    console.log(`[GENERATE KEY] p = ${p}`)\n    const g = bigInt.randBetween(2, p.subtract(1))//bigInt(getPRoot(p));\n    console.log(`[GENERATE KEY] g = ${g}`)\n    const x = bigInt.randBetween(2, p.subtract(1));\n    console.log(`[GENERATE KEY] x = ${x}`)\n    const y = g.modPow(x, p);\n    console.log(`[GENERATE KEY] y = ${y}`)\n\n    const result = {p, g, x, y};\n\n    return {\n        p,\n        g,\n        x,\n        y\n    };\n}\n\nfunction encryptMsg(msg, openKey) {\n    console.log(`[Encrypt] Encrypt ${msg}, open-key ${openKey.toString()}`);\n\n    let a = \"\";\n    let b = \"\";\n\n    for (let i = 0; i < msg.length; i++) {\n        let encryptNum = encryptNumber(msg.charCodeAt(i), openKey);\n        a += toStringBigInteger(encryptNum.a) + \",\";\n        b += toStringBigInteger(encryptNum.b) + \",\";\n    }\n\n    console.log(`[Encrypt] Result encrypt a = ${a}, b = ${b}`);\n    return {\n        allMessage: a + \"!\" + b,\n        a: a,\n        b: b\n    };\n}\n\nfunction encryptNumber(msg, openKey) {\n    console.log(`[Encrypt] Encrypt number ${msg}, open-key ${openKey.toString()}`);\n    const sessionKey = bigInt.randBetween(2, openKey.p - 2);\n    const a = openKey.g.modPow(sessionKey, openKey.p);\n    const b = bigInt(msg).multiply(openKey.y.modPow(sessionKey, openKey.p)).mod(openKey.p);\n    console.log(`[Encrypt] Result encrypt a = ${a.toString()}, b = ${b.toString()}`);\n\n    return {\n        a,\n        b\n    };\n}\n\nfunction toBigInt(str) {\n    const array = Array.from(str, (char) => char.charCodeAt(0) - 48);\n    return bigInt.fromArray(array, 74);\n}\n\nfunction decryptMsg(msg, secretKey) {\n    const [aStr, bStr] = msg.split(/!/);\n    console.log(`[Decrypt] Decrypt a = ${aStr}, b = ${bStr}. key ${secretKey.toString()}`);\n\n    let result = \"\";\n    const aLetters = aStr.split(/,/);\n    const bLetters = bStr.split(/,/);\n\n    for (let i = 0; i < aLetters.length - 1; i++) {\n        let resultNum = decryptNumber(toBigInt(aLetters[i]), toBigInt(bLetters[i]), secretKey);\n        result += String.fromCharCode(resultNum.toJSNumber());\n    }\n\n    console.log(`[Decrypt] Decrypt result = ${result}`);\n    return result;\n}\n\nfunction decryptNumber(aCode, bCode, secretKey) {\n    const a = bigInt(aCode);\n    const b = bigInt(bCode);\n    console.log(`[Decrypt] Decrypt a = ${a}, b = ${b}. key ${secretKey.toString()}`);\n    const result = b.multiply(a.pow(secretKey.p.minus(1).minus(secretKey.x))).mod(secretKey.p)\n    console.log(`[Decrypt] Decrypt result = ${result}`);\n    return result;\n}\n\nfunction toStringBigInteger(number) {\n    const values = number.toArray(74);\n    let result = \"\";\n    for (let i = 0; i < values.value.length; i++) {\n        result += String.fromCharCode(values.value[i] + 48);\n    }\n    return result;\n}\n\nfunction getPRoot(p) {\n    for (let i = bigInt(0); i.lesser(p); i.next()) {\n        if (isPRoot(p, i)) {\n            console.log(\"root = \" + i)\n            return i;\n        }\n    }\n    return 0;\n}\n\nfunction isPRoot(p, root) {\n    if (root.isZero() || root.eq(bigInt.one)) {\n        return false;\n    }\n    let last = bigInt.one;\n    const set = new Set();\n    for (let i = bigInt(0); i.lesser(p.subtract(1)); i++) {\n        last = last.multiply(root).mod(p);\n        if (set.has(last)) {\n            return false;\n        }\n        set.add(last);\n    }\n    return true;\n}\n\nfunction generateRandomPrime() {\n    while (true) {\n        let random = bigInt.randBetween(\"65536\", \"8388607\");\n        if (random.isPrime()) {\n            return random;\n        }\n    }\n}\n\nfunction App() {\n    const [username, setUsername] = useState(usernames[0]);\n    const [usernameTo, setUsernameTo] = useState(usernames[1]);\n    const [message, setMessage] = useState('');\n    const [messageA, setMessageA] = useState('');\n    const [messageB, setMessageB] = useState('');\n    const [inMessage, setInMessage] = useState('');\n    const [inDecryptMessage, setInDecryptMessage] = useState('');\n    const [myKey, setMyKey] = useState({})\n    const [isConnected, setIsConnected] = useState(false)\n    const [openKey, setOpenKey] = useState({})\n    const clientRef = useRef();\n\n    const handleChangeMsg = (msg) => {\n        let result = encryptMsg(msg.target.value, openKey);\n        setMessage(result.allMessage);\n        setMessageA(result.a);\n        setMessageB(result.b);\n    }\n\n    const handleSend = (event) => {\n        console.log(event)\n        const msg = {\n            username: usernameTo,\n            message: message\n        }\n        clientRef.current.sendMessage(\"/app/chat\", JSON.stringify(msg));\n    }\n\n    const handleShow = () => {\n        console.log(openKey)\n        console.log(myKey)\n    }\n\n    const handleCreateChat = () => {\n        let newSecretKey = generateNewKey();\n\n        const sendMsg = {\n            usernameTo: usernameTo,\n            usernameFrom: username,\n            p: newSecretKey.p,\n            g: newSecretKey.g,\n            y: newSecretKey.y,\n        }\n        axios.post(\"http://localhost:8080/api/create-chat\", sendMsg).then(r => setMyKey(newSecretKey))\n    }\n\n    const handleChangeUsername = () => {\n        const tmp = username;\n        setUsername(usernameTo)\n        setUsernameTo(tmp)\n    }\n\n    return (\n        <div>\n            <SockJsClient url='http://localhost:8080/ws' topics={['/user/' + username + '/messages' ]}\n                          onMessage={(msg) => {\n                              console.log(msg)\n                              console.log(\"chat\")\n                              const decryptMsg1 = decryptMsg(msg.message, myKey);\n                              console.log(decryptMsg1)\n                              setInMessage(msg.message)\n                              setInDecryptMessage(decryptMsg1.toString())\n                          }}\n                          ref={clientRef} />\n            <SockJsClient url='http://localhost:8080/ws' topics={['/user/' + username + '/create' ]}\n                          onMessage={(msg) => {\n                              console.log(\"create chat\")\n                              console.log(msg)\n                              let newSecretKey = generateNewKey();\n                              const sendMsg = {\n                                  usernameTo: msg.usernameTo,\n                                  usernameFrom: msg.usernameFrom,\n                                  p: newSecretKey.p,\n                                  g: newSecretKey.g,\n                                  y: newSecretKey.y,\n                              }\n                              console.log(sendMsg)\n                              axios.post(\"http://localhost:8080/api/create-chat/key\", sendMsg\n                              ).then(r => {\n                                  setMyKey(newSecretKey);\n                              });\n\n                              setOpenKey({\n                                  p: bigInt(msg.p),\n                                  g: bigInt(msg.g),\n                                  y: bigInt(msg.y),\n                              });\n                          }} />\n            <SockJsClient url='http://localhost:8080/ws' topics={['/user/' + username + '/key' ]}\n                          onMessage={(msg) => {\n                              console.log(\"key\")\n                              console.log(msg);\n                              setOpenKey({\n                                  p: bigInt(msg.p),\n                                  g: bigInt(msg.g),\n                                  y: bigInt(msg.y),\n                              });\n                          }} />\n            <Container fluid=\"md\" className=\"my-5\">\n                <Row className=\"mb-5\">\n                    <Col>\n                        <div>\n                            Hello, {username}\n                        </div>\n                        <Button\n                            variant=\"outline-primary\"\n                            size=\"sm\"\n                            onClick={handleChangeUsername}\n                            disabled={isConnected}\n                        >\n                            Изменить пользователя\n                        </Button>\n                    </Col>\n                </Row>\n                <Row className=\"mb-2 bg-light border p-3\" xs=\"auto\">\n                    <Col>\n                        <div className=\"mb-2 fw-bold\">Секретный (x) и открытый ключ (p, g, y) (мой)</div>\n                        <Row xs=\"auto\"><Col>x</Col><Col>{myKey.x?.toString()}</Col></Row>\n                        <Row xs=\"auto\"><Col>p</Col><Col>{myKey.p?.toString()}</Col></Row>\n                        <Row xs=\"auto\"><Col>g</Col><Col>{myKey.g?.toString()}</Col></Row>\n                        <Row xs=\"auto\"><Col>y</Col><Col>{myKey.y?.toString()}</Col></Row>\n                    </Col>\n                    <Col>\n                        <div className=\"mb-2 fw-bold\">Открытый ключ (p, g, y) (чужой)</div>\n                        <Row xs=\"auto\"><Col>p</Col><Col>{openKey.p?.toString()}</Col></Row>\n                        <Row xs=\"auto\"><Col>g</Col><Col>{openKey.g?.toString()}</Col></Row>\n                        <Row xs=\"auto\"><Col>y</Col><Col>{openKey.y?.toString()}</Col></Row>\n                    </Col>\n                </Row>\n                <Row className=\"mb-2\">\n                    <Button\n                        variant=\"primary\"\n                        onClick={handleCreateChat}\n                    >\n                        Соединить\n                    </Button>\n                </Row>\n                <Row className=\"mb-2\">\n                    <Tabs defaultActiveKey=\"send\" className=\"mb-3\">\n                        <Tab eventKey=\"send\" title=\"Отправить\">\n                            <Form>\n                                <Form.Group as={Row} className=\"mb-3\" controlId=\"formHorizontalCheck\">\n                                    <Col>\n                                        <Form.Control onChange={handleChangeMsg} type=\"text\"  placeholder=\"Сообщение\" />\n                                    </Col>\n                                </Form.Group>\n                                <Form.Group as={Row} className=\"mb-3\">\n                                    <Col sm={10}>\n                                        <Button type=\"button\" onClick={handleSend}>Отправить</Button>\n                                    </Col>\n                                </Form.Group>\n                            </Form>\n                            <hr />\n                            <Form.Group as={Row} className=\"mb-3\" controlId=\"formHorizontalCheck\">\n                                <Form.Label column sm=\"2\">\n                                    Результат шифрования с помощью чужого открытого ключа (a)\n                                </Form.Label>\n                                <Col sm=\"10\">\n                                    <Form.Control type=\"text\" placeholder=\"Результат шифрования (a)\" readOnly value={messageA}/>\n                                </Col>\n                            </Form.Group>\n                            <Form.Group as={Row} className=\"mb-3\" controlId=\"formHorizontalCheck\">\n                                <Form.Label column sm=\"2\">\n                                    Результат шифрования с помощью чужого открытого ключа (b)\n                                </Form.Label>\n                                <Col sm=\"10\">\n                                    <Form.Control type=\"text\" placeholder=\"Результат шифрования (b)\" readOnly value={messageB}/>\n                                </Col>\n                            </Form.Group>\n                        </Tab>\n                        <Tab eventKey=\"exit\" title=\"Входящие\">\n                            <Form.Group as={Row} className=\"mb-2\" controlId=\"formHorizontalCheck\">\n                                <Form.Label column sm=\"2\">\n                                    Пришло сообщение\n                                </Form.Label>\n                                <Col sm=\"10\">\n                                    <Form.Control type=\"text\" readOnly value={inMessage}/>\n                                </Col>\n                            </Form.Group>\n                            <Form.Group as={Row} className=\"mb-2\" controlId=\"formHorizontalCheck\">\n                                <Form.Label column sm=\"2\">\n                                    Расшифрованное сообщение при помощи моего секретного ключа\n                                </Form.Label>\n                                <Col sm=\"10\">\n                                    <Form.Control type=\"text\" readOnly value={inDecryptMessage}/>\n                                </Col>\n                            </Form.Group>\n                        </Tab>\n                    </Tabs>\n                </Row>\n            </Container>\n        </div>\n    );\n}\n\nexport default App;\n","C:\\Users\\pshbl\\IdeaProjects\\crypto-el-gamal\\front\\crypro-app\\src\\index.js",[],{"ruleId":"15","severity":1,"message":"16","line":20,"column":11,"nodeType":"17","messageId":"18","endLine":20,"endColumn":17},{"ruleId":"15","severity":1,"message":"19","line":103,"column":10,"nodeType":"17","messageId":"18","endLine":103,"endColumn":18},{"ruleId":"15","severity":1,"message":"20","line":147,"column":25,"nodeType":"17","messageId":"18","endLine":147,"endColumn":39},{"ruleId":"15","severity":1,"message":"21","line":167,"column":11,"nodeType":"17","messageId":"18","endLine":167,"endColumn":21},"no-unused-vars","'result' is assigned a value but never used.","Identifier","unusedVar","'getPRoot' is defined but never used.","'setIsConnected' is assigned a value but never used.","'handleShow' is assigned a value but never used."]